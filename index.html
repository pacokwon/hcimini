<html>
<head>
    <title>Miniproject</title>
    <style>
    #caption {
        color: white;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        font-size: 24px;
        height: 1.8em;
        line-height: 1.8em;
        text-align: center;
        position: absolute;
        top: 440px;
    }

    .capword:hover {
        font-weight: bold;
    }
    </style>
</head>
<body>
    <div id="app">
        <video controls preload="auto">
            <source src="../video.mp4" type="video/mp4"/>
            <!-- <track label="English" kind="subtitles" srclang="en" src="captions.vtt" default/> -->
        </video>
        <div id="caption"></div>
    </div>

    <script type="text/javascript">
        const captions = [{
            begin: '00:00:00,000',
            end: '00:00:03,230',
            // script: 'And looking at the history a little bit,'
            script: 'And looking at the history a little bit,'
        },
        {
            begin: '00:00:03,530',
            end: '00:00:10,340',
            script: 'all the way back in 1981, was the first time the graphical'
        },
        {
            begin: '00:00:10,420',
            end: '00:00:14,940',
            script: 'user interface and the operating system for supporting'
        },
        {
            begin: '00:00:14,910',
            end: '00:00:21,110',
            script: 'graphical ui has been introduced in the system called Xerox star.'
        },
        {
            begin: '00:00:21,120',
            end: '00:00:28,840',
            script: 'So it had a lot of these fantastic ideas that are currently used even after 40 years, right?'
        },
        {
            begin: '00:00:28,850',
            end: '00:00:35,650',
            script: 'The idea of icons, folders, and ethernet, file servers, print servers'
        },
        {
            begin: '00:00:35,660',
            end: '00:00:38,640',
            script: 'all these ideas came about in Xerox star.'
        },
        {
            begin: '00:00:38,650',
            end: '00:00:45,360',
            script: 'And it is known that Steve Jobs stole a lot of the ideas from Xerox.'
        }]

        const toMillis = time => parseFloat(time.split(':')[2].replace(',', '.'))
        const beginTimes = captions.map(e => toMillis(e.begin))
        const video = document.querySelector('video')
        const captionDiv = document.querySelector('#caption')
        let subIdx = 0;

        video.onloadeddata = () => {
            captionDiv.style.width = video.videoWidth
        }
        video.ontimeupdate = () => {
            const EPSILON = 0.2
            const currentTime = video.currentTime;
            const curIdx = beginTimes.reduce((acc, cur, idx) => Math.abs(currentTime - cur) < EPSILON ? idx : acc , null)
            subIdx = curIdx === null ? subIdx : curIdx
            if (curIdx !== null) {
                const words = captions[subIdx].script.split(' ')
                const spans = words.map(word => {
                    const span = document.createElement('span')
                    span.innerText = word + ' '
                    span.classList.add('capword')
                    span.onclick = e => { console.log(word) }
                    return span
                })

                captionDiv.innerHTML = ''
                spans.forEach(span => { captionDiv.appendChild(span) })

                // captionDiv.innerText = captions[subIdx].script
                console.log(captions[subIdx].script.split(' '))
            }
        }

    </script>
</body>
</html>
